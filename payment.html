<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500;600&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Mitr', sans-serif;
    }
    
    body {
      background-color: #fdf2f8;
      color: #831843;
      min-height: 100vh;
      padding: 0;
      margin: 0 auto;
    }
    
    h2 {
      color: #be185d;
      text-align: center;
      margin: 20px 0;
      font-weight: 600;
      font-size: 1.8rem;
      padding: 0 15px;
    }
    
    table {
      width: 100%;
      max-width: 800px;
      margin: 0 auto 20px;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(236, 72, 153, 0.1);
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #fbcfe8;
    }
    
    th {
      background-color: #fce7f3;
      color: #be185d;
      font-weight: 500;
    }
    
    #totalPrice {
      font-size: 1.2rem;
      font-weight: 600;
      color: #be185d;
      text-align: right;
      margin: 20px auto;
      max-width: 800px;
      padding: 0 15px;
    }
    
    .qr-section {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 800px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(236, 72, 153, 0.1);
    }
    
    .qr-section p {
      color: #831843;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    
    .qr-section img {
      max-width: 200px;
      border-radius: 10px;
      border: 1px solid #fbcfe8;
    }
    
    .form-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 15px;
    }
    
    label {
      display: block;
      color: #831843;
      font-weight: 500;
      margin-top: 15px;
    }
    
    input, textarea {
      width: 100%;
      padding: 12px 15px;
      margin: 8px 0 15px;
      border-radius: 8px;
      border: 1px solid #fbcfe8;
      background-color: #fdf2f8;
      font-size: 1rem;
      color: #831843;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: #ec4899;
      background-color: white;
    }
    
    input[type="file"] {
      padding: 8px;
    }
    
    button {
      width: 100%;
      padding: 14px;
      background-color: #ec4899;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      margin: 10px 0;
      transition: all 0.3s ease;
    }
    
    button:hover {
      background-color: #db2777;
      transform: translateY(-2px);
    }
    
    .msg {
      background-color: #f0fdf4;
      color: #166534;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
      margin: 20px 0;
      display: none;
      border: 1px solid #bbf7d0;
    }
    
    /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß */
    header {
      padding: 1rem;
      background: pink;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    #top {
      position: relative;
      background-color: #E282A8;
      border-radius: 50%;
      color: white;
      text-decoration: none;
      width: 50px;
      height: 50px;
      right: 97%;
      font-size: 30px;
      padding: 0px 8px;
    }

    .top-nav img {
      width: 100px;
      height: auto;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .search-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    #search {
      padding: 0rem 1rem;
      font-size: 1rem;
      border-radius: 30px;
      border: 1px solid #f0d6df;
      background-color: #fff9fa;
      outline: none;
      width: 200px;
      position: relative;
      margin-top: 10px;
      left: 35%;
      
    }

    #buy-more-btn {
      background-color: #E282A8;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      text-decoration: none;
      font-size: 0.9rem;
      white-space: nowrap;
      right: 70%;
      position: relative;

    }

    
    .top-nav img {
      width: 100px;
      height: auto;
    }
    
    #search {
      position: relative;
      left: 88%;
      padding: 4px 10px;
      border-radius: 20px;
      border: 1px solid #f0d6df;
      background-color: #fff9fa;
      width: 200px;
      margin-top: 12px;
    }
    
    #t1 {
      position: relative;
      left: 28%;
      background-color: #E282A8;
      color: white;
      padding: 3px 15px;
      border-radius: 20px;
      text-decoration: none;
    }
    
    
    
    @media (max-width: 768px) {
       header {
        padding: 0px;
        position: relative;
      }
      .top-nav {
        gap: 1rem;
      }
      
      .top-nav img {
        position: relative;
        transform: none;
        order: 1;
        width: 80px;
        margin: 0 auto;
        left: -30%;
      }
      
      .search-container {
        order: 2;
        width: 100%;
        justify-content: flex-end;
      }
      
      #search {
        width: 100%;
        position: relative;
        max-width: 90px;
        left: 80%;
        margin-top: 12px;
      }
      #t1{
        position: relative;
        left: 39%;
        padding: 2px 15px 2px 15px;
      }

      #top {
        position: relative;
        left: -38%;
        font-size: 40px;
        width: 50px;
        height: 50px;
        padding: 10px 10px 16px 10px;
      }
      
      h2 {
        font-size: 1.5rem;
      }
      
      th, td {
        padding: 10px 12px;
        font-size: 0.9rem;
      }
      
      .qr-section img {
        max-width: 180px;
      }
    }

    @media (max-width: 480px){

    header{
      margin: 0;
      padding: 10px;
    }
      .top-nav #top {
    width: 50px;
    height: 50px;
    background-color: #E282A8;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    left: -57%;
  }

  .top-nav #top i {
    color: white;
    font-size: 20px;
  }

      .top-nav img {
        position: relative;
        left: -38%;
      }

      #search {
        position: relative;
        bottom: 14px;
        left: 75%;
      }

      #t1{
        position: relative;
        bottom: -25px;
        left: 45%;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="top-nav">
      <img src="im/Logo2.png" alt="logo">
      <input id="search" type="text" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...">
      <a href="jee.html" id="t1">‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</a>
      <a href="review.html" id="top">‚Üê</a>
    </div>
  </header>

  <h2>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

  <table id="orderTable">
    <thead>
      <tr>
        <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
        <th>‡πÑ‡∏ã‡∏™‡πå</th>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="totalPrice"></p>

  <div class="qr-section">
    <p>üìå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
    <img src="im/qr.jpg" alt="QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô">
  </div>

  <div class="form-container">
    <label for="payer">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
    <input id="payer" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" readonly>

    <label for="slip">üìé ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
    <input id="slip" type="file" accept="image/*" required>

    <label for="note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
    <input id="note" type="text" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">

    <button id="payBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
    <div class="msg" id="doneMsg">‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</div>
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div class="loading-msg" id="loadingMsg">‚è≥ ‡∏£‡∏≠‡∏ã‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...</div>
  </div>

  <script>
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å pendingOrder ‡πÉ‡∏ô localStorage
    const pendingOrder = JSON.parse(localStorage.getItem("pendingOrder"));
    
    if (!pendingOrder) {
      alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà");
      window.location.href = "review.html";
    }

    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    document.getElementById("payer").value = pendingOrder.fullname;
    
    const tbody = document.querySelector("#orderTable tbody");
    let total = 0;
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    pendingOrder.items.forEach(item => {
      const price = item.qty * item.price;
      total += price;
      tbody.innerHTML += `
        <tr>
          <td>${item.name}</td>
          <td>${item.size || '-'}</td>
          <td>${item.qty}</td>
          <td>${price.toLocaleString()} ‡∏ø</td>
        </tr>
      `;
    });
    
    document.getElementById("totalPrice").textContent = `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${total.toLocaleString()} ‡∏ø`;

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    document.getElementById("payBtn").onclick = async () => {
      const slip = document.getElementById("slip").files[0];
      const note = document.getElementById("note").value.trim();
      
      if (!slip) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");
        return;
      }

      try {
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        document.getElementById("loadingMsg").style.display = "block";
        document.getElementById("payBtn").disabled = true;
        document.getElementById("payBtn").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
        
        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Discord
        await sendToDiscord(pendingOrder, slip, note);
        
        // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        document.getElementById("loadingMsg").style.display = "none";
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        document.getElementById("doneMsg").style.display = "block";
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ confirm
        localStorage.setItem("lastOrder", JSON.stringify(pendingOrder.items));
        localStorage.setItem("lastCustomer", pendingOrder.fullname);
        localStorage.setItem("lastQueue", pendingOrder.queueCode);
        
        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• pending order
        localStorage.removeItem("pendingOrder");
        
        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á confirm.html ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setTimeout(() => {
          window.location.href = "confirm.html";
        }, 1500);
        
      } catch (error) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        
        // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
        document.getElementById("loadingMsg").style.display = "none";
        document.getElementById("payBtn").disabled = false;
        document.getElementById("payBtn").textContent = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô";
        
        alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
      }
    };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Discord
    async function sendToDiscord(orderData, slipFile, note) {
      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Webhook URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      const webhookUrl = 'https://discordapp.com/api/webhooks/1394335643601080433/103SA4YLfjmrR7mpcEBP8vqa9_kyjDkJE1WhkkpQJpRghNCF1ggZg2n3qz3ejwyLYikP';
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Embed message
      const embed = {
        title: `üí∞ ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${orderData.queueCode}`,
        color: 0x00AA00, // ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
        fields: [
          {
            name: "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤",
            value: orderData.fullname,
            inline: true
          },
          {
            name: "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",
            value: orderData.phone,
            inline: true
          },
          {
            name: "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á",
            value: orderData.address,
            inline: false
          },
          {
            name: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
            value: orderData.items.map(item => 
              `‚Ä¢ ${item.name} (${item.size || '-'}) x${item.qty} = ${(item.price * item.qty).toLocaleString()} ‡∏ø`
            ).join('\n'),
            inline: false
          },
          {
            name: "‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°",
            value: `${orderData.total.toLocaleString()} ‡∏ø`,
            inline: true
          },
          ...(note ? [{
            name: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏",
            value: note,
            inline: false
          }] : [])
        ],
        timestamp: new Date().toISOString()
      };

      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏•‡∏¥‡∏õ
      const mainFormData = new FormData();
      mainFormData.append('payload_json', JSON.stringify({
        embeds: [embed],
        content: `üí≥ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${orderData.queueCode}`
      }));
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ
      mainFormData.append('file', slipFile, 'slip.jpg');
      
      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å
      const mainResponse = await fetch(webhookUrl, {
        method: 'POST',
        body: mainFormData
      });

      if (!mainResponse.ok) {
        throw new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏õ Discord ‡πÑ‡∏î‡πâ (${mainResponse.status})`);
      }

      // ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö parallel ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏∏‡∏°
      const itemsPerBatch = 8; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏∏‡∏°
      const totalBatches = Math.ceil(orderData.items.length / itemsPerBatch);
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á array ‡∏Ç‡∏≠‡∏á promises ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö parallel
      const batchPromises = [];
      
      for (let batchIndex = 0; batchIndex < totalBatches; batchIndex++) {
        const startIndex = batchIndex * itemsPerBatch;
        const endIndex = Math.min(startIndex + itemsPerBatch, orderData.items.length);
        const batchItems = orderData.items.slice(startIndex, endIndex);
        
        if (batchItems.length === 0) continue;
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á promise ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡∏°
        const batchPromise = (async () => {
          const batchFormData = new FormData();
          batchFormData.append('payload_json', JSON.stringify({
            content: `üì¶ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${orderData.queueCode} (‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà ${batchIndex + 1}/${totalBatches})`
          }));
          
          let fileCount = 0;
          
          // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡∏°‡∏ô‡∏µ‡πâ
          const imagePromises = batchItems.map(async (item, i) => {
            try {
              let imageBlob;
              
              // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ image ‡πÄ‡∏õ‡πá‡∏ô URL ‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
              if (item.image && (item.image.startsWith('http') || item.image.startsWith('data:image'))) {
                const response = await fetch(item.image);
                imageBlob = await response.blob();
              } else if (item.image) {
                const response = await fetch(item.image);
                imageBlob = await response.blob();
              } else {
                return null;
              }
              
              return {
                blob: imageBlob,
                name: `${item.name.replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g, '_')}_${i}.jpg`
              };
              
            } catch (error) {
              console.warn("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:", item.image, error);
              return null;
            }
          });
          
          // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡∏°‡∏ô‡∏µ‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
          const imageResults = await Promise.all(imagePromises);
          
          // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏•‡∏á‡πÉ‡∏ô FormData
          imageResults.forEach((result) => {
            if (result) {
              batchFormData.append(`file${fileCount}`, result.blob, result.name);
              fileCount++;
            }
          });
          
          // ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏∏‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
          if (fileCount > 0) {
            const batchResponse = await fetch(webhookUrl, {
              method: 'POST',
              body: batchFormData
            });

            if (!batchResponse.ok) {
              console.warn(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡∏•‡∏∏‡∏°‡∏ó‡∏µ‡πà ${batchIndex + 1} ‡πÑ‡∏õ Discord ‡πÑ‡∏î‡πâ (${batchResponse.status})`);
            }
          }
        })();
        
        batchPromises.push(batchPromise);
      }
      
      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Å‡∏•‡∏∏‡∏°‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à (‡πÅ‡∏ö‡∏ö parallel)
      await Promise.allSettled(batchPromises);
    }
  </script>
</body>
</html>