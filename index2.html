<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="top-nav">
      <input id="search" type="text" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." />
      <a href="jee.html" id="t1">‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</a>
      <a href= "Bug.html"  id="top">‚Üê</a>
      <img src="im/Logo2.png" alt="logo">
    </div>
  </header>

  <div class="header-image-container">
    <img src="#" alt="Header Image" class="header-image">
  </div>

  <div class="products-container">
    <h2 class="category-title">‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡∏™‡∏µ‡∏ó‡∏≠‡∏á</h2>
    <div class="grid" id="necklace-grid"></div>

    <h2 class="category-title">‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡∏™‡∏µ‡πÄ‡∏á‡∏¥‡∏ô</h2>
    <div class="grid" id="neck2-grid"></div>
    
    <img src="im\IMG_4682.PNG" alt="">
    <h1 class="category-title">‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á</h1>

    <h2 class="category-title">‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå 1</h2>
    <div class="grid" id="pendant-grid"></div>

    <h2 class="category-title">‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå 2</h2>
    <div class="grid" id="pendant2-grid"></div>

    <h2 class="category-title">‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå 3</h2>
    <div class="grid" id="pendant3-grid"></div>

    <h2 class="category-title">‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå 4</h2>
    <div class="grid" id="pendant4-grid"></div>
  </div>

  <div id="cart-bar">
    <span id="cart-info"></span>
    <button class="review-btn">
      <i class="fas fa-shopping-bag"></i> ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
    </button>
  </div>

  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
  <div id="imageModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="expandedImage">
  </div>
 <script>
      // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    const productData = [
    // ‡∏™‡∏£‡πâ‡∏≠‡∏¢ (4 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°)
    {
      id: 1,
      name: "‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡πÇ‡∏ã‡πà‡∏™‡∏µ‡∏ó‡∏≠‡∏á",
      price: 189,
      stock: 5,
      img: "im/‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏≠‡∏ó‡∏≠‡∏á.JPG",
      category: "necklace"
    },
   

   //‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á 1
    {
      id: 5,
      name: "‡∏à‡∏µ‡πâ‡∏ú‡∏∂‡πâ‡∏á‡πÄ‡∏û‡∏ä‡∏£",
      price: 0,
      stock: 4,
      img: "im/1.png",
      category: "pendant"
    },
    {
      id: 6,
      name: "‡∏à‡∏µ‡πâ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ",
      price: 0,
      stock: 4,
      img: "im/2.png",
      category: "pendant"
    },
    {
      id: 7,
      name: "‡∏à‡∏µ‡πâ‡∏î‡∏≤‡∏ß",
      price: 0,
      stock: 4,
      img: "im/3.png",
      category: "pendant"
    },
    {
      id: 8,
      name: "‡∏à‡∏µ‡πâ‡∏´‡∏±‡∏ß‡πÉ‡∏à",
      price: 0,
      stock: 4,
      img: "im/4.png",
      category: "pendant"
    },
    {
      id: 9,
      name: "‡∏à‡∏µ‡πâ‡∏û‡∏£‡∏¥‡∏Å",
      price: 0,
      stock: 4,
      img: "im/5.png",
      category: "pendant"
    },
    {
      id: 10,
      name: "‡∏à‡∏µ‡πâ‡∏´‡∏≠‡∏¢‡πÄ‡∏ä‡∏•",
      price: 0,
      stock: 4,
      img: "im/6.png",
      category: "pendant"
    },
    {
      id: 11,
      name: "‡∏à‡∏µ‡πâ‡∏´‡∏≠‡∏¢‡∏Å‡πâ‡∏ô‡πÅ‡∏´‡∏•‡∏°",
      price: 0,
      stock: 4,
      img: "im/7.png",
      category: "pendant"
    },
    {
      id: 12,
      name: "‡∏à‡∏µ‡πâ‡∏õ‡∏•‡∏≤‡∏î‡∏≤‡∏ß",
      price: 0,
      stock: 4,
      img: "im/8.png",
      category: "pendant"
    },
    //‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á 1
   // ‡∏à‡∏µ‡∏ó‡∏≠‡∏á2
    {
      id: 13,
      name: "‡∏à‡∏µ‡πâ‡∏ú‡∏∂‡πâ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏î‡∏≥",
      price: 0,
      stock: 4,
      img: "im/9.png",
      category: "pendant2"
    },
    {
      id: 14,
      name: "‡∏à‡∏µ‡πâ‡∏ú‡∏∂‡πâ‡∏á‡∏ó‡∏≠‡∏á‡∏î‡∏≥",
      price: 0,
      stock: 4,
      img: "im/10.png",
      category: "pendant2"
    },
    {
      id: 15,
      name: "‡∏à‡∏µ‡πâ‡∏ú‡∏∂‡πâ‡∏á‡∏Ç‡∏≤‡∏ß‡∏î‡∏≥",
      price: 0,
      stock: 4,
      img: "im/11.png",
      category: "pendant2"
    },
    {
      id: 16,
      name: "‡∏à‡∏µ‡πâ‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°",
      price: 0,
      stock: 4,
      img: "im/12.png",
      category: "pendant2"
    },
    {
      id: 17,
      name: "‡∏à‡∏µ‡πâ‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå",
      price: 0,
      stock: 4,
      img: "im/13.png",
      category: "pendant2"
    },
    {
      id: 18,
      name: "‡∏à‡∏µ‡πâ‡πÅ‡∏Å‡πâ‡∏ß‡πÇ‡∏Ñ‡πä‡∏Å",
      price: 0,
      stock: 4,
      img: "im/14.png",
      category: "pendant2"
    },
    {
      id: 19,
      name: "‡∏à‡∏µ‡πâ‡∏õ‡∏π‡πÄ‡∏û‡∏ä‡∏£",
      price: 0,
      stock: 4,
      img: "im/15.png",
      category: "pendant2"
    },
    {
      id: 20,
      name: "‡∏à‡∏µ‡πâ‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å",
      price: 0,
      stock: 4,
      img: "im/16.png",
      category: "pendant2"
    },
    //‡∏à‡∏µ‡πâ‡∏™‡∏µ‡∏ó‡∏≠‡∏á2
   
    
    
    

    
    
    // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà (20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
    ...Array.from({ length: 20 }, (_, i) => ({
      id: i + 105,
      name: `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ${i + 1}`,
      price: 990 + (i % 8) * 300,
      stock: 2 + (i % 5),
      img: `im/new${(i % 4) + 1}.jpg`, // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û 4 ‡πÅ‡∏ö‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ô
      category: "new"
    }))
  ];

    const store = {
      getCart() {
        return JSON.parse(localStorage.getItem("cart") || "[]");
      },
      setCart(c) {
        localStorage.setItem("cart", JSON.stringify(c));
      },
      getStock() {
        return JSON.parse(localStorage.getItem("productStock") || "null");
      },
      setStock(stockList) {
        localStorage.setItem("productStock", JSON.stringify(stockList));
      }
    };

    // ‡πÇ‡∏´‡∏•‡∏î stock ‡∏à‡∏≤‡∏Å localStorage ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ default ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
    function getProductStock() {
      let productStock = store.getStock();
      if (!productStock) {
        productStock = productData.map(p => ({ id: p.id, stock: p.stock }));
        store.setStock(productStock);
      }
      return productStock;
    }

    const necklaceGrid = document.getElementById("necklace-grid");
    const neck2Grid = document.getElementById("neck2-grid");
    const pendantGrid = document.getElementById("pendant-grid");
    const pendant2Grid = document.getElementById("pendant2-grid");
    const pendant3Grid = document.getElementById("pendant3-grid");
    const pendant4Grid = document.getElementById("pendant4-grid");
    const searchBox = document.getElementById("search");
    const cartBar = document.getElementById("cart-bar");
    const cartInfo = document.getElementById("cart-info");
    const modal = document.getElementById("imageModal");
    const modalImg = document.getElementById("expandedImage");
    const closeBtn = document.querySelector(".close");

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞ stock
    function getSampleProducts() {
      const productStock = getProductStock();
      return productData.map(p => {
        const s = productStock.find(x => x.id === p.id);
        return { ...p, stock: s ? s.stock : p.stock };
      });
    }

    function renderCart() {
  const cart = store.getCart();
  if (cart.length) {
    const total = cart.reduce((s, i) => s + i.qty, 0);
    const totalPrice = cart.reduce((s, i) => s + (i.qty * i.price), 0);
    cartInfo.innerHTML = `<i class="fas fa-shopping-cart"></i> ${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ${totalPrice.toLocaleString()}‡∏ø`;
    cartBar.classList.add("show");
  } else {
    cartBar.classList.remove("show");
  }
}
    renderCart();



    function draw(filter = "") {
      necklaceGrid.innerHTML = "";
      neck2Grid.innerHTML = "";
      pendantGrid.innerHTML = "";
      pendant2Grid.innerHTML = "";
      pendant3Grid.innerHTML = "";
      
      // ‡πÅ‡∏™‡∏î‡∏á loading animation
      necklaceGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
      neck2Grid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
      pendantGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
      
      // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      setTimeout(() => {
        const sampleProducts = getSampleProducts();

        const filteredProducts = sampleProducts
          .filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
        
        // ‡πÅ‡∏ö‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
        const necklaces = filteredProducts.filter(p => p.category === 'necklace');
        const neck2 = filteredProducts.filter(p => p.category === 'neck2');
        const pendants = filteredProducts.filter(p => p.category === 'pendant');
        const pendants2 = filteredProducts.filter(p => p.category === 'pendant2');
        const pendants3 = filteredProducts.filter(p => p.category === 'pendant3');
        const pendants4 = filteredProducts.filter(p => p.category === 'pendant4');

        necklaceGrid.innerHTML = "";
        neck2Grid.innerHTML = "";
        pendantGrid.innerHTML = "";
        pendant2Grid.innerHTML = "";
        pendant3Grid.innerHTML = "";
        pendant4Grid.innerHTML = "";

        // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏£‡πâ‡∏≠‡∏¢ (4 ‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏ô‡∏™‡∏∏‡∏î)
        necklaces.forEach(p => {
          const card = createProductCard(p);
          necklaceGrid.appendChild(card);
        });

        neck2.forEach(p => {
          const card = createProductCard(p);
          neck2Grid.appendChild(card);
        });

        // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏µ‡πâ‡πÉ‡∏™‡πà‡∏™‡∏£‡πâ‡∏≠‡∏¢
        pendants.forEach(p => {
          const card = createProductCard(p);
          pendantGrid.appendChild(card);
        });
        pendants2.forEach(p => {
          const card = createProductCard(p);
          pendant2Grid.appendChild(card);
        });
        pendants3.forEach(p => {
          const card = createProductCard(p);
          pendant3Grid.appendChild(card);
        });
        pendants4.forEach(p => {
          const card = createProductCard(p);
          pendant4Grid.appendChild(card);
        });
      }, 500);
    }

    function createProductCard(p) {
      const card = document.createElement("div");
      card.className = "card";
      const isOut = p.stock === 0;

      card.innerHTML = `
        <div class="card-img-container">
          <img src="${p.img}" alt="${p.name}" loading="lazy">
          <div class="zoom-icon"><i class="fas fa-search-plus"></i></div>
        </div>
        <h4>${p.name}</h4>
        <p class="price">${p.price.toLocaleString()}‡∏ø</p>
        <p class="stock ${isOut ? 'out-of-stock' : 'in-stock'}">
          <i class="fas fa-${isOut ? 'times-circle' : 'check-circle'}"></i> ${isOut ? "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î" : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${p.stock} ‡∏ä‡∏¥‡πâ‡∏ô`}
        </p>
        <button class="add-btn" ${isOut ? "disabled" : ""}>
          <i class="fas fa-plus"></i> ${isOut ? "‡∏´‡∏°‡∏î" : "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤"}
        </button>
      `;

      const btn = card.querySelector(".add-btn");
      btn.onclick = () => {
  if (p.stock === 0) return alert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å");

  const cart = store.getCart();
  const found = cart.find(i => i.id === p.id);
  const qtyInCart = found ? found.qty : 0;

  if (qtyInCart >= p.stock) return alert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å");


if (p.category === 'pendant') {
  const totalNecklaces = cart
    .filter(i => {
      const cat = productData.find(p => p.id === i.id)?.category;
      return cat === 'necklace' || cat === 'neck2';
    })
    .reduce((sum, i) => sum + i.qty, 0);

  const totalPendants = cart
    .filter(i => productData.find(p => p.id === i.id)?.category === 'pendant')
    .reduce((sum, i) => sum + i.qty, 0);

  if (totalNecklaces === 0) {
    return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏µ‡πâ");
  }

  const maxAllowedPendants = totalNecklaces * 3;
  if (totalPendants >= maxAllowedPendants) {
    return alert(`‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${maxAllowedPendants} ‡∏ä‡∏¥‡πâ‡∏ô (${totalNecklaces} ‡∏™‡∏£‡πâ‡∏≠‡∏¢ x 3 ‡∏à‡∏µ‡πâ)`);
  }
}



  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  found ? found.qty++ : cart.push({ 
    id: p.id, 
    name: p.name, 
    price: p.price, 
    qty: 1,
    img: p.img
  });

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï stock ‡πÉ‡∏ô localStorage
  let productStock = getProductStock();
  const index = productStock.findIndex(prod => prod.id === p.id);
  if (index >= 0) {
    productStock[index].stock--;
  }
  store.setStock(productStock);
  store.setCart(cart);

  draw(searchBox.value);
  renderCart();

  // ‡πÅ‡∏™‡∏î‡∏á animation ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  btn.innerHTML = '<i class="fas fa-check"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß';
  btn.style.background = '#2ecc71';
  setTimeout(() => {
    btn.innerHTML = `<i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤`;
    btn.style.background = 'linear-gradient(to right, var(--primary-color), var(--primary-dark))';
  }, 1000);
};

      // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      const imgContainer = card.querySelector(".card-img-container");
      imgContainer.onclick = (e) => {
        if (e.target.tagName === 'IMG' || e.target.closest('.card-img-container')) {
          modal.style.display = "block";
          modalImg.src = p.img;
          modalImg.alt = p.name;
          document.body.style.overflow = 'hidden';
        }
      };

      return card;
    }

    // ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° X
    closeBtn.onclick = function() {
      modal.style.display = "none";
      document.body.style.overflow = 'auto';
    }

    // ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
    modal.onclick = function(event) {
      if (event.target === modal) {
        modal.style.display = "none";
        document.body.style.overflow = 'auto';
      }
    }

    document.querySelector(".review-btn").onclick = () => {
      location.href = "review.html";
    };

    function viewDetail(product) {
  // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á localStorage
  localStorage.setItem("selectedProduct", JSON.stringify(product));
  // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ detail.html
  window.location.href = "dital.html";
}

function createProductCard(p) {
  const card = document.createElement("div");
  card.className = "card";
  const isOut = p.stock === 0;

  card.innerHTML = `
    <div class="card-img-container">
      <img src="${p.img}" alt="${p.name}" loading="lazy">
      <div class="zoom-icon"><i class="fas fa-search-plus"></i></div>
    </div>
    <h4>${p.name}</h4>
    <p class="price">${p.price.toLocaleString()}‡∏ø</p>
    <p class="stock ${isOut ? 'out-of-stock' : 'in-stock'}">
      <i class="fas fa-${isOut ? 'times-circle' : 'check-circle'}"></i> ${isOut ? "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î" : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${p.stock} ‡∏ä‡∏¥‡πâ‡∏ô`}
    </p>
    <button class="add-btn" ${isOut ? "disabled" : ""}>
      <i class="fas fa-plus"></i> ${isOut ? "‡∏´‡∏°‡∏î" : "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤"}
    </button>
  `;

  const btn = card.querySelector(".add-btn");
  btn.onclick = (e) => {
    e.stopPropagation(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ trigger click ‡∏ó‡∏µ‡πà card
    if (p.stock === 0) return alert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å");

    const cart = store.getCart();
    const found = cart.find(i => i.id === p.id);
    const qtyInCart = found ? found.qty : 0;

    if (qtyInCart >= p.stock) return alert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å");

    if (p.category === 'pendant') {
  const totalNecklaces = cart
    .filter(i => {
      const cat = productData.find(p => p.id === i.id)?.category;
      return cat === 'necklace' || cat === 'neck2';
    })
    .reduce((sum, i) => sum + i.qty, 0);

  const totalPendants = cart
    .filter(i => productData.find(p => p.id === i.id)?.category === 'pendant')
    .reduce((sum, i) => sum + i.qty, 0);

  if (totalNecklaces === 0) {
    return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏µ‡πâ");
  }

  const maxAllowedPendants = totalNecklaces * 3;
  if (totalPendants >= maxAllowedPendants) {
    return alert(`‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${maxAllowedPendants} ‡∏ä‡∏¥‡πâ‡∏ô (${totalNecklaces} ‡∏™‡∏£‡πâ‡∏≠‡∏¢ x 3 ‡∏à‡∏µ‡πâ)`);
  }
}

    found ? found.qty++ : cart.push({
      id: p.id,
      name: p.name,
      price: p.price,
      qty: 1,
      img: p.img
    });

    let productStock = getProductStock();
    const index = productStock.findIndex(prod => prod.id === p.id);
    if (index >= 0) {
      productStock[index].stock--;
    }
    store.setStock(productStock);
    store.setCart(cart);

    draw(searchBox.value);
    renderCart();

    btn.innerHTML = '<i class="fas fa-check"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß';
    btn.style.background = '#2ecc71';
    setTimeout(() => {
      btn.innerHTML = `<i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤`;
      btn.style.background = 'linear-gradient(to right, var(--primary-color), var(--primary-dark))';
    }, 1000);
  };

  const imgContainer = card.querySelector(".card-img-container");
  imgContainer.onclick = (e) => {
    e.stopPropagation(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ trigger click ‡∏ó‡∏µ‡πà card
    modal.style.display = "block";
    modalImg.src = p.img;
    modalImg.alt = p.name;
    document.body.style.overflow = 'hidden';
  };

  card.onclick = () => {
    viewDetail(p);
  };

  return card;
}
    

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    draw();
    searchBox.oninput = e => draw(e.target.value);
    renderCart();
 </script>
</body>
</html>